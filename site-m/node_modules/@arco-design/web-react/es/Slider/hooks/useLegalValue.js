var __read = (this && this.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};
import { useMemo } from 'react';
import { isArray, isNumber, isUndefined, isObject, isEmptyObject } from '../../_util/is';
import { getPrecision } from '../utils';
export default function useLegalValue(props) {
    var isRange = props.isRange, min = props.min, max = props.max, onlyMarkValue = props.onlyMarkValue, step = props.step, marks = props.marks;
    var precision = useMemo(function () { return getPrecision(step); }, [step]);
    // 在只允许选择 marks 中的值的时候，找到离value最接近的值
    function getMarkValue(val) {
        if (!isObject(marks) || isEmptyObject(marks)) {
            console.warn('marks must be an object when onlyMarkValue is true');
            return min;
        }
        if (marks[val]) {
            return val;
        }
        var keys = Object.keys(marks);
        var diffs = keys.map(function (x) { return Math.abs(val - parseFloat(x)); });
        var minIndex = diffs.indexOf(Math.min.apply(null, diffs));
        return parseFloat(keys[minIndex]);
    }
    // 判断值是否在[min, max]区间内，并且满足步长或是标签值
    function getLegalValue(val) {
        if (isUndefined(val))
            return min;
        if (val <= min)
            return min;
        if (val >= max)
            return max;
        if (onlyMarkValue)
            return getMarkValue(val);
        var steps = Math.round(val / step);
        return parseFloat(Number(steps * step).toFixed(precision));
    }
    function isLegalValue(val) {
        return getLegalValue(val) === val;
    }
    // 获取合法的 range value
    function getLegalRangeValue(val) {
        var _a = __read([min, min], 2), beginVal = _a[0], endVal = _a[1];
        if (isRange) {
            if (isArray(val)) {
                beginVal = getLegalValue(val[0]);
                endVal = getLegalValue(val[1]);
            }
            else {
                console.error('value must be an array when range is true');
            }
        }
        else if (isNumber(val)) {
            endVal = getLegalValue(val);
        }
        else {
            console.error('value must be a number when range is false');
        }
        return [beginVal, endVal];
    }
    return {
        getLegalRangeValue: getLegalRangeValue,
        getLegalValue: getLegalValue,
        isLegalValue: isLegalValue,
    };
}
